# Настройка ежедневного обновления в 7:00 по Москве

## Автоматическая настройка (рекомендуется)

### Способ 1: PowerShell скрипт
1. Откройте PowerShell **от имени администратора**
2. Перейдите в папку проекта:
   ```powershell
   cd D:\MKT_PRICE
   ```
3. Запустите скрипт настройки:
   ```powershell
   .\setup_daily_scheduler.ps1
   ```

### Способ 2: Через планировщик задач Windows
1. Откройте "Планировщик задач" (Task Scheduler)
2. Нажмите "Создать задачу..." (Create Task...)
3. Настройте задачу:
   - **Имя**: "DailyPriceUpdate7AM"
   - **Описание**: "Ежедневное обновление цен товаров в 7:00 по Москве"
4. Вкладка "Триггеры" (Triggers):
   - Нажмите "Создать..." (New...)
   - **Начать задачу**: По расписанию
   - **Настройки**: Ежедневно
   - **Начало**: 07:00:00
   - **Повторять каждые**: 1 день
5. Вкладка "Действия" (Actions):
   - Нажмите "Создать..." (New...)
   - **Действие**: Запустить программу
   - **Программа/скрипт**: `D:\MKT_PRICE\daily_update_7am.bat`
   - **Рабочая папка**: `D:\MKT_PRICE`
6. Вкладка "Настройки" (Settings):
   - ✅ Разрешить выполнение по требованию
   - ✅ Выполнить задачу как можно скорее после пропуска
   - ✅ Если задача не удалась, перезапустить через: 1 минута
7. Нажмите "ОК" и введите пароль администратора

## Ручная настройка через командную строку

```cmd
schtasks /create /tn "DailyPriceUpdate7AM" /tr "D:\MKT_PRICE\daily_update_7am.bat" /sc daily /st 07:00 /ru SYSTEM
```

## Проверка настройки

### Проверить задачу:
```powershell
Get-ScheduledTask -TaskName "DailyPriceUpdate7AM"
```

### Посмотреть информацию о задаче:
```powershell
Get-ScheduledTask -TaskName "DailyPriceUpdate7AM" | Get-ScheduledTaskInfo
```

### Запустить задачу вручную:
```powershell
Start-ScheduledTask -TaskName "DailyPriceUpdate7AM"
```

## Управление задачей

### Удалить задачу:
```powershell
Unregister-ScheduledTask -TaskName "DailyPriceUpdate7AM"
```

### Изменить время выполнения:
1. Откройте планировщик задач
2. Найдите задачу "DailyPriceUpdate7AM"
3. Двойной клик → вкладка "Триггеры"
4. Измените время на нужное

## Мониторинг

### Просмотр логов:
- Логи сохраняются в файл `daily_update.log`
- Расположение: `D:\MKT_PRICE\daily_update.log`

### Проверка последнего выполнения:
```powershell
Get-ScheduledTask -TaskName "DailyPriceUpdate7AM" | Get-ScheduledTaskInfo | Select-Object LastRunTime, LastTaskResult
```

## Важные моменты

1. **Время**: Задача настроена на 7:00 по московскому времени
2. **Автозапуск**: Задача будет выполняться даже если компьютер был выключен
3. **Логирование**: Все запуски записываются в лог-файл
4. **Права**: Задача выполняется от имени SYSTEM (не требует входа пользователя)
5. **Сеть**: Задача выполняется только при наличии интернет-соединения

## Тестирование

Для тестирования можно запустить задачу вручную:
```powershell
Start-ScheduledTask -TaskName "DailyPriceUpdate7AM"
```

Или запустить скрипт напрямую:
```cmd
D:\MKT_PRICE\daily_update_7am.bat
```
